#!/bin/bash

# Stop nginx service if already running
service nginx stop

# Modify nginx configuration to run as nginx user
sed -i 's/user\s*[^;]*/user nginx;/g' /etc/nginx/nginx.conf

# Modify nginx configuration to listen on port 8080 for all active IPs
sed -i 's/listen\s*[^;]*/listen 8080;/g' /etc/nginx/sites-available/default

# Restart nginx service
service nginx start

# Check nginx process status
ps auxff | grep ngin[x]

# Check if nginx is listening on port 8080
nc -z -w1 0 8080 && echo "nginx is listening on port 8080"
