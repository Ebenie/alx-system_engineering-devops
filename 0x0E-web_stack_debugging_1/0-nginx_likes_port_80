#!/usr/bin/env bash
# Check if Nginx is installed
if ! command -v nginx &> /dev/null; then
    echo "Nginx is not installed. Installing..."
    sudo apt update
    sudo apt install nginx -y
fi

# Verify Nginx configuration
nginx_config="/etc/nginx/nginx.conf"
if ! grep -q "listen\s*80;" "$nginx_config"; then
    echo "Configuring Nginx to listen on port 80..."
    sudo sed -i 's/\(^\s*listen\s*\)[0-9]*\(\s*;\)/\180\2/' "$nginx_config"
fi

# Check for conflicting processes on port 80
conflicting_processes=$(sudo ss -tln | grep ":80 ")
if [[ -n "$conflicting_processes" ]]; then
    echo "Conflicting processes are using port 80:"
    echo "$conflicting_processes"
    exit 1
fi

# Restart Nginx
echo "Restarting Nginx..."
sudo systemctl restart nginx
if [ $? -ne 0 ]; then
    echo "Failed to restart Nginx. Check the logs for more details."
    exit 1
fi

echo "Nginx is now configured to listen on port 80."


